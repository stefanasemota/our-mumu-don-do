/**
 * Core Philosophy:
 * This ruleset enforces a public read model for all client-side requests.
 * All educational content is considered public and can be read by any user,
 * whether authenticated or anonymous. Write operations (create, update, delete)
 * are restricted to authenticated users, reflecting a security model where
 * data is managed exclusively by a trusted party (e.g., via the admin dashboard).
 *
 * Data Structure:
 * The data is organized into a single top-level collection:
 * - /weeklyEducationalTopics/{weeklyEducationalTopicId}: Stores the educational
 *   content, including denormalized story pages.
 *
 * Key Security Decisions:
 * - Public Read Access: All documents in the `weeklyEducationalTopics` collection
 *   are publicly readable to support the application's content delivery function.
 * - Authenticated Writes: To protect the integrity of the educational content,
 *   write operations from the client are only allowed for authenticated users.
 *   This is designed to work with the password-protected admin dashboard.
 *
 * Denormalization for Authorization:
 * The data model denormalizes story pages directly into the topic documents.
 * Since the access model is simple (public read), no specific denormalization
 * is required for authorization checks.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description
     *   Allows public, read-only access to all weekly educational topics. Write
     *   operations are restricted to authenticated users to allow seeding from
     *   the admin dashboard.
     * @path
     *   /weeklyEducationalTopics/{weeklyEducationalTopicId}
     * @allow
     *   An anonymous user reading a specific educational topic document.
     *   Example: `(get) /weeklyEducationalTopics/some-topic-id`
     * @deny
     *   An unauthenticated user attempting to create a new topic.
     *   Example: `(create) /weeklyEducationalTopics/new-topic`
     * @principle
     *   Protects data integrity by enforcing a read-only model for the public,
     *   while allowing a trusted, authenticated user to manage content.
     */
    match /weeklyEducationalTopics/{weeklyEducationalTopicId} {
      // READ: Anyone can read the educational topics and list them.
      allow get: if true;
      allow list: if true;

      // WRITE: Only authenticated users can write.
      allow write: if request.auth != null;
    }
  }
}
